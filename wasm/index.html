<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Development server</title>
	</head>
	<body>
		<p>Open a console to access the Surreal class!</p>

    <p>Current permission status is <b id="status">unavailable</b>.</p>

    <p><button onclick="requestPermission()">Request permission</button></p>
    <p><button onclick="nonPersistentNotification()">Non-persistent notification</button></p>
    <p><button onclick="persistentNotification()">Persistent notification</button></p>

    <script>
      var $status = document.getElementById('status');

      if ('Notification' in window) {
        $status.innerText = Notification.permission;
      }

      function requestPermission() {
        if (!('Notification' in window)) {
          alert('Notification API not supported!');
          return;
        }
        
        Notification.requestPermission(function (result) {
          $status.innerText = result;
        });
      }

      function nonPersistentNotification() {
        if (!('Notification' in window)) {
          alert('Notification API not supported!');
          return;
        }
        
        try {
          var notification = new Notification("Hi there - non-persistent!");
        } catch (err) {
          alert('Notification API error: ' + err);
        }
      }

      function persistentNotification() {
        if (!('Notification' in window) || !('ServiceWorkerRegistration' in window)) {
          alert('Persistent Notification API not supported!');
          return;
        }
        
        try {
          navigator.serviceWorker.getRegistration()
            .then((reg) => reg.showNotification("Hi there - persistent!"))
            .catch((err) => alert('Service Worker registration error: ' + err));
        } catch (err) {
          alert('Notification API error: ' + err);
        }
      }
    </script>

		<script type="module" defer>
			// import Surreal from './lib/full.js';
      import { Surreal } from 'https://unpkg.com/surrealdb.wasm/lib/full.js';

			if (typeof window !== 'undefined') {
				window.Surreal = Surreal;
			}

      let db = new Surreal();

      try {
        await db.connect('indxdb://MyDatabase');
        await db.use({ ns: 'test', db: 'base'});

        let created = await db.create("person", {
          title: "Founder & CEO",
          name: {
            first: "Tobie",
            last: "Morgan Hitchcock",
          },
          marketing: true,
          identifier: Math.random().toString(36).substr(2, 10),
        })

        console.log(created);
      } catch (e) {
        	console.log(e);
      }
      
		</script>
	</body>
</html>
